<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2021a"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S1 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S2 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><div  class = 'S0'><span>Convert an affine UTM projection to Albers</span></div><div  class = 'S0'><span>This example comes from interpretation of an AVIRIS-NG image from the 2016 ISRO-NASA campaign whereby the AVIRIS data were acquired over many sites in India, as described in the book Spectrum of India. Because flight lines from aircraft missions are often long and narrow and don't follow a N-S or E-W direction, a rotated projection is often appropriate. The ISRO-NASA campaign employed a UTM projection rotated to follow each flight line. In this example, the image is the derived fractional snow cover for each pixel, rotated from the affine UTM projection to an Albers projection appropriate for High Mountain Asia.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">function </span><span >AffineUTM2Albers()</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >m = matfile(</span><span style="color: rgb(170, 4, 249);">'AffineExample.mat'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >disp(</span><span style="color: rgb(170, 4, 249);">'input UTM projection, note the TransformationType is ''affine'''</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >InRR = m.InR;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >fSCA = m.fSCA;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >~verLessThan(</span><span style="color: rgb(170, 4, 249);">'map'</span><span >,</span><span style="color: rgb(170, 4, 249);">'5.0'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    InRR.ProjectedCRS = projcrs(32643);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >disp(InRR);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(2, 128, 9);">% orientation of the projection is calculated from the latitude and</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(2, 128, 9);">% longitude of the NW and NE corners</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >[x,y] = intrinsicToWorld(InRR,[1 InRR.RasterSize(2)],[1 InRR.RasterSize(1)]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >verLessThan(</span><span style="color: rgb(170, 4, 249);">'map'</span><span >,</span><span style="color: rgb(170, 4, 249);">'5.0'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">try</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >        [lat,lon] = projinv(m.UTM43,x,y);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">catch</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >        [lat,lon] = minvtran(m.UTM43,x,y);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    [lat,lon] = projinv(InRR.ProjectedCRS,x,y)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >[arclen,azimuth] = distance(lat(2),lon(2),lat(1),lon(1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >disp([</span><span style="color: rgb(170, 4, 249);">'Distance from NE to NW corner is ' </span><span >num2str(arclen)</span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    </span><span style="color: rgb(170, 4, 249);">' deg in direction ' </span><span >num2str(360-azimuth) </span><span style="color: rgb(170, 4, 249);">' counterclockwise from north.'</span><span >])</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(2, 128, 9);">%reproject to High Mountain Asia Albers</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >verLessThan(</span><span style="color: rgb(170, 4, 249);">'map'</span><span >,</span><span style="color: rgb(170, 4, 249);">'5.0'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    [A,OutRR] = rasterReprojection(fSCA,InRR,</span><span style="color: rgb(170, 4, 249);">'InProj'</span><span >,m.UTM43,</span><span style="color: rgb(170, 4, 249);">'OutProj'</span><span >,HMAAlbers);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    [A,OutRR] = rasterReprojection(fSCA,InRR,</span><span style="color: rgb(170, 4, 249);">'OutProj'</span><span >,HMAAlbers);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >disp([</span><span style="color: rgb(170, 4, 249);">'Note also that the RasterExtentInWorldY is greater ('</span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    num2str(round(OutRR.RasterExtentInWorldY)) </span><span style="color: rgb(170, 4, 249);">' vs '</span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >    num2str(round(InRR.RasterExtentInWorldY)) </span><span style="color: rgb(170, 4, 249);">') because of the rotation.'</span><span >])</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >subplot(2,1,1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >mapshow(fSCA,InRR,</span><span style="color: rgb(170, 4, 249);">'DisplayType'</span><span >,</span><span style="color: rgb(170, 4, 249);">'surface'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >title(</span><span style="color: rgb(170, 4, 249);">'fractional snow in UTM zone 43'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(170, 4, 249);">'UTM Northing'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(170, 4, 249);">'UTM Easting'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >axis </span><span style="color: rgb(170, 4, 249);">equal tight</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >subplot(2,1,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >mapshow(A,OutRR,</span><span style="color: rgb(170, 4, 249);">'DisplayType'</span><span >,</span><span style="color: rgb(170, 4, 249);">'surface'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >title(</span><span style="color: rgb(170, 4, 249);">'fractional snow in HMA Albers'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(170, 4, 249);">'Albers Northing'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(170, 4, 249);">'Albers Easting'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >colorbar</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >axis </span><span style="color: rgb(170, 4, 249);">equal tight</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >disp(</span><span style="color: rgb(170, 4, 249);">'Albers projection, note the TransformationType is ''rectilinear'''</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >disp(OutRR)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
function AffineUTM2Albers()
%  AFFINEUTM2ALBERS Convert an affine UTM projection to Albers
% 
% This example comes from interpretation of an AVIRIS-NG image from the 2016 
% ISRO-NASA campaign whereby the AVIRIS data were acquired over many sites in 
% India, as described in the book Spectrum of India. Because flight lines from 
% aircraft missions are often long and narrow and don't follow a N-S or E-W direction, 
% a rotated projection is often appropriate. The ISRO-NASA campaign employed a 
% UTM projection rotated to follow each flight line. In this example, the image 
% is the derived fractional snow cover for each pixel, rotated from the affine 
% UTM projection to an Albers projection appropriate for High Mountain Asia.
m = matfile('AffineExample.mat');
disp('input UTM projection, note the TransformationType is ''affine''')
InRR = m.InR;
fSCA = m.fSCA;
if ~verLessThan('map','5.0')
    InRR.ProjectedCRS = projcrs(32643);
end
disp(InRR);
% orientation of the projection is calculated from the latitude and
% longitude of the NW and NE corners
[x,y] = intrinsicToWorld(InRR,[1 InRR.RasterSize(2)],[1 InRR.RasterSize(1)]);
if verLessThan('map','5.0')
    try
        [lat,lon] = projinv(m.UTM43,x,y);
    catch
        [lat,lon] = minvtran(m.UTM43,x,y);
    end
else
    [lat,lon] = projinv(InRR.ProjectedCRS,x,y)
end
[arclen,azimuth] = distance(lat(2),lon(2),lat(1),lon(1));
disp(['Distance from NE to NW corner is ' num2str(arclen)...
    ' deg in direction ' num2str(360-azimuth) ' counterclockwise from north.'])
%reproject to High Mountain Asia Albers
if verLessThan('map','5.0')
    [A,OutRR] = rasterReprojection(fSCA,InRR,'InProj',m.UTM43,'OutProj',HMAAlbers);
else
    [A,OutRR] = rasterReprojection(fSCA,InRR,'OutProj',HMAAlbers);
end
disp(['Note also that the RasterExtentInWorldY is greater ('...
    num2str(round(OutRR.RasterExtentInWorldY)) ' vs '...
    num2str(round(InRR.RasterExtentInWorldY)) ') because of the rotation.'])
subplot(2,1,1)
mapshow(fSCA,InRR,'DisplayType','surface')
title('fractional snow in UTM zone 43')
ylabel('UTM Northing')
xlabel('UTM Easting')
axis equal tight
subplot(2,1,2)
mapshow(A,OutRR,'DisplayType','surface')
title('fractional snow in HMA Albers')
ylabel('Albers Northing')
xlabel('Albers Easting')
colorbar
axis equal tight
disp('Albers projection, note the TransformationType is ''rectilinear''')
disp(OutRR)
end
##### SOURCE END #####
-->
</div></body></html>